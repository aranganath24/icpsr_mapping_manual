<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Tutorial | A Guide to Mapping ICPSR Data in R Studio</title>
  <meta name="description" content="4 Tutorial | A Guide to Mapping ICPSR Data in R Studio" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Tutorial | A Guide to Mapping ICPSR Data in R Studio" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Tutorial | A Guide to Mapping ICPSR Data in R Studio" />
  
  
  

<meta name="author" content="Aditya Ranganath" />


<meta name="date" content="2021-09-14" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="preliminaries-and-set-up.html"/>

<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Mapping ICPSR Data</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Preface</a></li>
<li class="chapter" data-level="2" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>2</b> Introduction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="introduction.html"><a href="introduction.html#motivation"><i class="fa fa-check"></i><b>2.1</b> Motivation</a></li>
<li class="chapter" data-level="2.2" data-path="introduction.html"><a href="introduction.html#scope-and-objectives"><i class="fa fa-check"></i><b>2.2</b> Scope and Objectives</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html"><i class="fa fa-check"></i><b>3</b> Preliminaries and Set-Up</a>
<ul>
<li class="chapter" data-level="3.1" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#data"><i class="fa fa-check"></i><b>3.1</b> Data</a></li>
<li class="chapter" data-level="3.2" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#r-and-r-studio-installation"><i class="fa fa-check"></i><b>3.2</b> R and R Studio Installation</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#windows-installation-instructions"><i class="fa fa-check"></i><b>3.2.1</b> Windows Installation Instructions</a></li>
<li class="chapter" data-level="3.2.2" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#macos-installation-instructions"><i class="fa fa-check"></i><b>3.2.2</b> macOS Installation Instructions</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#the-r-studio-interface"><i class="fa fa-check"></i><b>3.3</b> The R Studio Interface</a></li>
<li class="chapter" data-level="3.4" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#install-packages"><i class="fa fa-check"></i><b>3.4</b> Install Packages</a></li>
<li class="chapter" data-level="3.5" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#load-libraries"><i class="fa fa-check"></i><b>3.5</b> Load Libraries</a></li>
<li class="chapter" data-level="3.6" data-path="preliminaries-and-set-up.html"><a href="preliminaries-and-set-up.html#set-working-directory"><i class="fa fa-check"></i><b>3.6</b> Set Working Directory</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tutorial.html"><a href="tutorial.html"><i class="fa fa-check"></i><b>4</b> Tutorial</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tutorial.html"><a href="tutorial.html#load-and-view-data"><i class="fa fa-check"></i><b>4.1</b> Load and View Data</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="tutorial.html"><a href="tutorial.html#icpsr-covid-19-tabular-data"><i class="fa fa-check"></i><b>4.1.1</b> ICPSR Covid-19 Tabular Data</a></li>
<li class="chapter" data-level="4.1.2" data-path="tutorial.html"><a href="tutorial.html#country-boundaries-spatial-data"><i class="fa fa-check"></i><b>4.1.2</b> Country Boundaries Spatial Data</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Guide to Mapping ICPSR Data in R Studio</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tutorial" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Tutorial</h1>
<div id="load-and-view-data" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load and View Data</h2>
<p>Now that we’ve taken care of those preliminary steps, let’s bring in the tutorial data into our R environment so that we can begin working with it. There are two pieces of data we’ll need to load:</p>
<ul>
<li>The ICPSR tabular dataset on government policy responses to Covid-19 (Section 4.1.1)</li>
<li>A spatial dataset of world country boundaries; we will bring this dataset into R Studio via the <code>ne_countries</code> function of the “rnaturalearth” package (Section 4.1.2)</li>
</ul>
<div id="icpsr-covid-19-tabular-data" class="section level3" number="4.1.1">
<h3><span class="header-section-number">4.1.1</span> ICPSR Covid-19 Tabular Data</h3>
<p>When importing tabular data that you have saved on our computer into R Studio, it’s important to first understand some of the details of the data we’re trying to import. The first thing to note is the type of file we’re working with, which is indicated by the file extension; here, we can note that the ICPSR data is a .xlsx file, which means that it’s an Excel file (but note that .xlsx files can also be opened in spreadsheet software programs other than Excel). That means we’ll have to import it into R Studio using a function designed specifically to handle Excel files. To that end, we’ll use the <code>read_excel</code> function from the <em>readxl</em> package. Recall that if you want to learn more about a function or a package, simply type a question mark followed by the package or function name in the console, and relevant information will appear in the “Help” tab of the “Files/Plots/Packages/Help/Viewer” window on the bottom right of our R Studio interface. For example, if we wanted to learn more about the <code>read_excel</code>function, we would type <code>?read_excel</code> into the console.</p>
<p>Before using the <code>read_excel</code> function to bring in the , it could be helpful to open up the data outside the R environment to see whether the dataset has any features that we have to account for when loading it into our R environment. When we first open the spreadsheet, it will look something like this:</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-10"></span>
<img src="images/excel_open.png" alt="ICPSR Dataset in Spreadsheet: Description Tab" width="100%" />
<p class="caption">
Figure 4.1: ICPSR Dataset in Spreadsheet: Description Tab
</p>
</div>
<p>Note that when we open the spreadsheet, we land on its first tab (or “sheet”), which is titled “Description”. This part of the spreadsheet effectively functions as a data codebook, which we can look through to understand the dataset’s various variables and and assess how they were measured. To open up the actual dataset, we can toggle to the “Dataset” tab by pressing the corresponding button on the bottom-left of the spreadsheet (highlighted in red below):</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-11"></span>
<img src="images/excel_tabs.png" alt="ICPSR Dataset in Spreadsheet: Dataset Tab" width="100%" />
<p class="caption">
Figure 4.2: ICPSR Dataset in Spreadsheet: Dataset Tab
</p>
</div>
<p>The fact that the ICPSR dataset has two sheets within it is important; it means that when we load it into R, we’ll have to explicitly specify the sheet (i.e. the “Dataset” sheet) we want to import.</p>
<p>Now, let’s go ahead and load the “Dataset” sheet of the ICPSR data file. Type the following code into your script, and run it:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="tutorial.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Imports &quot;Dataset&quot; sheet from ICPSR Excel file into R Studio, and assigns the dataset to an object called &quot;covid_data&quot;</span></span>
<span id="cb6-2"><a href="tutorial.html#cb6-2" aria-hidden="true" tabindex="-1"></a>covid_data<span class="ot">&lt;-</span><span class="fu">read_excel</span>(<span class="st">&quot;Gov_Responses2Covid19_last.xlsx&quot;</span>, <span class="at">sheet=</span><span class="st">&quot;Dataset&quot;</span>)</span></code></pre></div>
<p>Let’s unpack that code. As we noted above, <code>read_excel</code> is the function used to bring in Excel spreadsheet data into R. The function has two arguments; the first (“Gov_Responses2Covid19_last.xlsx”) is the name of the file we want to import, while the second (sheet=“Dataset”) specifies that we specifically want to import the the “Dataset” sheet from that Excel file. This code is then assigned, using <code>&lt;-</code> (R’s assignment operator) to a new object that we call <code>covid_data</code>. This means that the output of the code on the right hand side of the assignment operator is now assigned to the <code>covid_data</code> object. Think of this object as a container of sorts, one which holds, or “contains”, the output of the code to the right of the assignment operator. Object assignment isn’t necessary; we could have brought the data into R Studio by simply typing the code to the right of the assignment operator. However, assigning the dataset to an object allows for the more flexible and intuitive handling of data, so it is a common practice.</p>
<p>Note that after typing the code from the previous codeblock into your R script and running it, you still won’t actually see the dataset within the R environment. There are many ways to pull up and inspect the data; in this tutorial, we’ll use the <code>View</code> function, which will bring up the data as a separate tab in the “Source” window. To display the contents of the <code>covid_data</code> object (in other words, the dataset we just imported), type and run the following code:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="tutorial.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Brings up dataset held in the &quot;covid_data&quot; object in R Studio&#39;s data viewer</span></span>
<span id="cb7-2"><a href="tutorial.html#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">View</span>(covid_data)</span></code></pre></div>
<p>Within your R Studio environment, the result of running <code>View(covid_data)</code> will look something like this (dataset outlined in red):</p>
<div class="figure"><span style="display:block;" id="fig:unnamed-chunk-14"></span>
<img src="images/viewdata.png" alt="Viewing ICPSR Dataset in R Environment" width="100%" />
<p class="caption">
Figure 4.3: Viewing ICPSR Dataset in R Environment
</p>
</div>
<p>You can scroll up/down and across the dataset within the data viewer.</p>
</div>
<div id="country-boundaries-spatial-data" class="section level3" number="4.1.2">
<h3><span class="header-section-number">4.1.2</span> Country Boundaries Spatial Data</h3>
<p>Now that we have our tabular data on government responses to Covid-19 loaded into R Studio, let’s bring spatial data on world country borders into memory. Eventually, we’ll represent the Covid-19 data on a map by joining it to the spatial data on country boundaries that we will now bring in.</p>
<p>When working with spatial data in R, you will sometimes want to import data that you collected on your own, or data that you downloaded. There are several functions in the <code>sf</code> package that will allow you to easily import your external spatial data in R; if you need to do this, you should consult the package’s documentation.</p>
<p>In our case, we won’t have to download and import the spatial data we need into R Studio, since there are R packages that already contain this spatial data. In particular, we’ll use the <code>ne_countries</code> function of the <em>rnaturalearth</em> package to bring the country border dataset into our R environment. Note the two arguments we pass into the <code>ne_countries</code> function: the “scale” argument specifies that we want to use a medium scale when rendering the map (the other options are ‘small’ and ‘large’), while the “returnclass” argument specifies that we want the spatial dataset in ‘sf’ format, which is a spatial data format that works well with the <em>tmap</em> mapping package we’ll use later. As in the previous section, we’ll assign the dataset to an object so that we can easily work with it later; we’ll call this object “country_boundaries”:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="tutorial.html#cb8-1" aria-hidden="true" tabindex="-1"></a>country_boundaries<span class="ot">&lt;-</span><span class="fu">ne_countries</span>(<span class="at">scale=</span><span class="st">&quot;medium&quot;</span>, <span class="at">returnclass=</span><span class="st">&quot;sf&quot;</span>)</span></code></pre></div>
<p>Now that the spatial layer of country boundaries is in our R environment, let’s go ahead and open it up. A spatial dataset consists of features and attributes. Features are represented visually, and use geometric shapes shapes (such as lines, points, or polygons) to represent real-world phenomena in a way that corresponds to their spatial locations. An attribute refers to information about a given feature; attributes for a spatial dataset are usually presented in a table, where each row corresponds to a given feature, and columns represent various attributes.</p>
<p>Let’s first open up the features, and examine the dataset’s visual representation. To do so, we’ll have to use a mapping package called <em>tmap</em>. To bring up the features of the dataset, we have to first tell <em>tmap</em> what data we want to map; we do this by first passing the name of the object that contains the dataset (here, “country_boundaries”) to the <code>tm_shape</code> function, and then specifying that our features (i.e. country borders) are represented as polygons through the <code>tm_polygons</code> function. The <code>tm_polygons</code> function does not require any arguments. In the <em>tmap</em> package, we can connect functions together through a plus sign (+). When we type in and run the following code, the result is a visual representation of the dataset contained in the “country_boundaries” object we defined above, i.e. a political map of the world:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="tutorial.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tm_shape</span>(country_boundaries)<span class="sc">+</span></span>
<span id="cb9-2"><a href="tutorial.html#cb9-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tm_polygons</span>()</span></code></pre></div>
<p><img src="bookdownproj_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="preliminaries-and-set-up.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/aranganath24/icpsr_mapping_manual/edit/master/04-main-lesson.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/aranganath24/icpsr_mapping_manual/blob/master/04-main-lesson.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
